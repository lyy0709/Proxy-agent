# 安全与隐私风险评估

本项目通过 Bash 安装脚本在 VPS 上部署 Xray-core、sing-box 及相关周边（Nginx、防火墙规则、WARP 等）。下列要点总结了安装流程中的潜在安全/隐私风险，并提供可操作的改进建议。

## 主要风险

1. **以 root 执行的脚本绕过基础安全控制**  
   * 安装命令默认关闭 TLS 证书校验（`--no-check-certificate`），并直接以 root 运行下载的脚本，容易遭受中间人攻击或镜像劫持。建议强制校验证书或提供离线校验指纹与签名。  
   * 脚本在 CentOS 场景要求用户关闭 SELinux，否则退出安装，削弱主机自带的强制访问控制。可改为兼容性配置而非关闭安全机制。  
   * 安装/控制逻辑未做最小权限分离，所有操作均在 root 下完成，若脚本或依赖被篡改会放大危害面。

2. **第三方二进制与规则文件无校验下载**  
   * Xray-core、geoip/geosite 规则等直接从 GitHub 以 `wget`/`curl` 下载并解压，未进行哈希或签名校验，存在供应链投毒风险。建议提供固定版本、校验和或签名验证流程。  
   * 同理，WARP 软件源和 Cloudflare 公钥通过网络直接导入，缺少证书/公钥来源验证链，易被源站劫持。

3. **网络与防火墙规则自动修改**  
   * 脚本会在 UFW、firewalld 或 iptables 上自动开放监听端口，写入持久规则并重载，用户若缺乏审计可能导致额外暴露面。建议增加交互式确认和变更回滚，或输出可复核的变更清单。  
   * WARP 安装流程会注册账户、启用常驻代理并写入自启动，可能改变原有流量路径且未提示对出口流量的影响和隐私日志策略。

4. **域名/IP 绑定校验过于严格，可能暴露真实 IP**  
   * 脚本会比较解析 IP 与 VPS 公网 IP 不一致即终止，这要求域名直接解析到服务器真实地址，不适用于前置 CDN/隐藏源站的场景。若用户误用，可能被迫暴露真实 IP。建议支持“仅验证可达性”或允许自定义检查策略。

## 改进建议概要

- 提供脚本与核心二进制的签名/哈希校验，默认开启 TLS 证书校验，并给出可验证的发布指纹。
- 以最小权限运行：拆分需 root 的步骤，其余部分使用普通用户执行；敏感操作前增加确认提示。
- 防火墙与路由改动输出详细变更，支持自动备份与回滚。
- 支持在存在 CDN/反向代理的部署模式下跳过“域名与公网 IP 完全一致”的硬校验，降低暴露风险。
- 对第三方源（如 Cloudflare WARP）提供来源验证与可选禁用开关，避免在敏感环境下被动安装。
