# Proxy-agent ä»£ç å®¡è®¡å†å²è®°å½•

**é¡¹ç›®**: [Lynthar/Proxy-agent](https://github.com/Lynthar/Proxy-agent)
**æºé¡¹ç›®**: [mack-a/v2ray-agent](https://github.com/mack-a/v2ray-agent)
**æœ€åæ›´æ–°**: 2025-12-14

---

## é¡¹ç›®æ¦‚è§ˆ

| æŒ‡æ ‡ | Proxy-agent | æºé¡¹ç›® (mack-a) |
|------|-------------|-----------------|
| **ä¸»è„šæœ¬è¡Œæ•°** | ~12,500 è¡Œ | ~9,650 è¡Œ |
| **å‡½æ•°æ•°é‡** | 216+ | 187 |
| **å…¨å±€å˜é‡** | 62+ | ~50+ |
| **æ¨¡å—åŒ–** | âœ… è¿›è¡Œä¸­ (lib/) | âŒ å•ä¸€æ–‡ä»¶ |
| **åè®®æ”¯æŒ** | 15 ç§ | 15 ç§ |

---

## é—®é¢˜ä¿®å¤æ±‡æ€»

### æ‰€æœ‰é—®é¢˜å‡å·²ä¿®å¤ (2025-12-13)

| ç¼–å· | ä¸¥é‡æ€§ | ç±»åˆ« | é—®é¢˜æè¿° | çŠ¶æ€ |
|------|--------|------|----------|------|
| 1 | ğŸ”´ é«˜ | é…ç½®é”™è¯¯ | sing-box SOCKS5 å…¥ç«™æ·»åŠ äº†ä¸å­˜åœ¨çš„ `aead` å­—æ®µ | âœ… å·²ä¿®å¤ |
| 2 | ğŸ”´ é«˜ | è·¯ç”±ç¼ºå¤± | å…¨å±€ SOCKS5 å‡ºç«™è½¬å‘ç¼ºå°‘ `route.final` é…ç½® | âœ… å·²ä¿®å¤ |
| 3 | ğŸŸ  ä¸­ | é€»è¾‘é”™è¯¯ | Hysteria2 å¸¦å®½é…ç½® `up_mbps`/`down_mbps` åå‘ | âœ… å·²ä¿®å¤ |
| 4 | ğŸŸ  ä¸­ | é…ç½®é”™è¯¯ | Xray å…¥ç«™é…ç½®åŒ…å«æ— æ•ˆçš„ `add` å­—æ®µ | âœ… å·²ä¿®å¤ |
| 5 | ğŸŸ  ä¸­ | æ­»ä»£ç  | `initRealityClientServersName` ä¸­ elif æ¡ä»¶æ°¸ä¸æ‰§è¡Œ | âœ… å·²ä¿®å¤ |
| 6 | ğŸŸ¡ ä½ | æ­»ä»£ç  | è¢«æ³¨é‡Šçš„ `initTuicConfig` å‡½æ•° | âœ… å·²åˆ é™¤ |
| 7 | ğŸŸ¡ ä½ | æ­»ä»£ç  | è¢«æ³¨é‡Šçš„ `initXrayFrontingConfig` å‡½æ•° | âœ… å·²åˆ é™¤ |
| 8 | ğŸŸ¡ ä½ | å®‰å…¨å»ºè®® | Reality shortIds ä½¿ç”¨ç©ºå­—ç¬¦ä¸² `""` | âœ… å·²ä¿®å¤ |
| 9 | ğŸŸ¡ ä½ | å®‰å…¨å»ºè®® | Reality shortIds ç¡¬ç¼–ç å›ºå®šå€¼ | âœ… å·²ä¿®å¤ |
| 10 | ğŸŸ¡ ä½ | é…ç½®å»ºè®® | Reality maxTimeDiff è®¾ç½®è¿‡å¤§ (70000ms) | âœ… å·²ä¿®å¤ |
| 11 | ğŸŸ¡ ä½ | ä»£ç å†—ä½™ | SOCKS5 å…¥ç«™çš„ AEAD é€‰é¡¹è¯¯å¯¼æ€§èœå•æ–‡æœ¬ | âœ… å·²ä¿®å¤ |
| 12 | âšª ä¿¡æ¯ | ç‰ˆæœ¬å…¼å®¹ | Xray x25519 è¾“å‡ºæ ¼å¼å˜åŒ–éœ€æ³¨æ„ | âœ… å·²ä¿®å¤ |

---

## è¯¦ç»†é—®é¢˜è¯´æ˜

### 1. sing-box SOCKS5 å…¥ç«™ aead å­—æ®µé”™è¯¯

**ä½ç½®**: `install.sh:7863`

**é—®é¢˜**: æ ¹æ® [sing-box SOCKS æ–‡æ¡£](https://sing-box.sagernet.org/configuration/inbound/socks/)ï¼ŒSOCKS å…¥ç«™çš„ users é…ç½®åªæ”¯æŒ `username` å’Œ `password` å­—æ®µï¼Œä¸æ”¯æŒ `aead` å­—æ®µã€‚

**é”™è¯¯ä¿¡æ¯**:
```
FATAL[0000] inbounds[0].users[0].aead: json: unknown field "aead"
```

**ä¿®å¤**: ç§»é™¤äº†è¯¥å­—æ®µã€‚

---

### 2. å…¨å±€ SOCKS5 å‡ºç«™è½¬å‘ç¼ºå°‘è·¯ç”±é…ç½®

**ä½ç½®**: `install.sh:7620-7666` (`setSocks5OutboundRoutingAll` å‡½æ•°)

**é—®é¢˜**: å‡½æ•°åªåˆ é™¤äº†å…¶ä»–è·¯ç”±è§„åˆ™ï¼Œä½†æ²¡æœ‰åˆ›å»ºè®©æ‰€æœ‰æµé‡èµ° `socks5_outbound` çš„è·¯ç”±é…ç½®ã€‚

**ä¿®å¤**: æ·»åŠ äº† `route.final: "socks5_outbound"` é…ç½®ã€‚

---

### 3. Hysteria2 å¸¦å®½é…ç½®åå‘

**é—®é¢˜**: æ ¹æ® [Hysteria2 å®˜æ–¹æ–‡æ¡£](https://v2.hysteria.network/docs/advanced/Full-Server-Config/)ï¼š
> "Note that the server's upload speed is the client's download speed, and vice versa."

**ä¿®å¤**: äº¤æ¢ `up_mbps` å’Œ `down_mbps` çš„å€¼ã€‚

---

### 4-5. æ­»ä»£ç æ¸…ç†

ç§»é™¤äº† `initRealityClientServersName` ä¸­æ°¸ä¸æ‰§è¡Œçš„ elif åˆ†æ”¯ï¼Œä»¥åŠè¢«æ³¨é‡Šçš„ `initTuicConfig` å’Œ `initXrayFrontingConfig` å‡½æ•°ã€‚

---

### 8-10. Reality å®‰å…¨æ”¹è¿›

| æ”¹è¿›é¡¹ | ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|--------|
| shortIds | `["", "6ba85179e30d4fc2"]` (ç¡¬ç¼–ç +ç©ºå€¼) | `[éšæœºç”Ÿæˆ]` |
| maxTimeDiff | 70000ms | 60000ms |
| x25519 å¯†é’¥æå– | ä»…æ”¯æŒæ–°ç‰ˆæ ¼å¼ | å…¼å®¹æ–°æ—§ç‰ˆæœ¬ |

---

## å®‰å…¨æ€§æ”¹è¿›

### SOCKS5 è®¤è¯æ¼æ´æé†’

**é—®é¢˜**: sing-box 1.4.4 åŠæ›´æ—©ç‰ˆæœ¬å­˜åœ¨ SOCKS5 å…¥ç«™è®¤è¯ç»•è¿‡æ¼æ´ (CVE-2023-43644)ã€‚

**å»ºè®®**:
1. ç¡®ä¿ sing-box ç‰ˆæœ¬ >= 1.4.5
2. ä¸è¦å°† SOCKS5 å…¥ç«™æš´éœ²åœ¨ä¸å®‰å…¨çš„ç½‘ç»œç¯å¢ƒä¸­

### TLS è¯ä¹¦éªŒè¯

**å»ºè®®**: è·³è¿‡ TLS è¯ä¹¦éªŒè¯ (`insecure=true`) å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ï¼Œå·²æ·»åŠ é£é™©è­¦å‘Šã€‚

---

## ä¸æºé¡¹ç›®å¯¹æ¯”

| æ–¹é¢ | æºé¡¹ç›® | Proxy-agent | è¯„ä»· |
|------|--------|-------------|------|
| **ä»£ç ç»„ç»‡** | å•ä¸€æ–‡ä»¶ | æ¨¡å—åŒ– (lib/) | âœ… æ›´å¥½ |
| **å®‰å…¨æ€§** | ç¡¬ç¼–ç å¯†é’¥ | åŠ¨æ€ç”Ÿæˆ | âœ… æ›´å¥½ |
| **Bug æ•°é‡** | å·²çŸ¥é—®é¢˜ | å·²ä¿®å¤ 12 é¡¹ | âœ… æ›´å¥½ |
| **SOCKS5 åŠŸèƒ½** | åŸºç¡€å®ç° | å¢å¼ºåŠŸèƒ½ | âœ… æ›´å¥½ |
| **æ–‡æ¡£** | åŸºç¡€ | è¯¦ç»†åˆ†æ | âœ… æ›´å¥½ |

---

## ä»£ç è´¨é‡è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **åŠŸèƒ½å®Œæ•´æ€§** | 9/10 | æ”¯æŒ15ç§åè®®ï¼ŒåŠŸèƒ½å…¨é¢ |
| **ä»£ç ç»„ç»‡** | 7/10 | æ¨¡å—åŒ–è¿›è¡Œä¸­ï¼Œä¸»è„šæœ¬ä»éœ€æ‹†åˆ† |
| **å®‰å…¨æ€§** | 8/10 | æ”¹è¿›äº†å¯†é’¥ç”Ÿæˆ |
| **å¯ç»´æŠ¤æ€§** | 6/10 | å…¨å±€å˜é‡è¿‡å¤šï¼Œéœ€ç»§ç»­é‡æ„ |
| **æ–‡æ¡£** | 9/10 | æ–‡æ¡£è¯¦ç»†å®Œå–„ |
| **è§„èŒƒç¬¦åˆåº¦** | 9/10 | ç¬¦åˆ Xray/sing-box å®˜æ–¹è§„èŒƒ |

**æ€»ä½“è¯„åˆ†: â­â­â­â­ (4/5)**

---

## æ¨¡å—åŒ–è¿›åº¦

### Phase 1: å·²å®Œæˆ âœ…
- `lib/constants.sh` - åè®®IDã€é…ç½®è·¯å¾„ã€é»˜è®¤å€¼
- `lib/utils.sh` - å­—ç¬¦ä¸²å¤„ç†ã€JSONéªŒè¯ã€UUID
- `lib/system-detect.sh` - ç³»ç»Ÿæ£€æµ‹ã€CPUæ£€æµ‹
- `lib/service-control.sh` - Xray/sing-box/NginxæœåŠ¡æ§åˆ¶

### Phase 2: å·²å®Œæˆ âœ…
- `lib/json-utils.sh` - JSONå®‰å…¨è¯»å†™ã€éªŒè¯ã€åŸå­æ“ä½œ
- `lib/protocol-registry.sh` - åè®®æ³¨å†Œè¡¨ã€æ£€æµ‹
- `lib/config-reader.sh` - é…ç½®è¯»å–æ¥å£
- `lib/i18n.sh` - å›½é™…åŒ–æ”¯æŒ

### Phase 3: å¾…å®æ–½ â³
- `lib/tls-manager.sh` - TLSè¯ä¹¦ç®¡ç†
- `lib/subscription.sh` - è®¢é˜…ç”Ÿæˆ
- `lib/user-manager.sh` - ç”¨æˆ·CRUDæ“ä½œ
- `lib/menu-framework.sh` - èœå•æ¸²æŸ“æ¡†æ¶

---

## å‚è€ƒèµ„æ–™

- [Xray-core GitHub](https://github.com/XTLS/Xray-core)
- [Xray-examples](https://github.com/XTLS/Xray-examples)
- [REALITY Protocol](https://github.com/XTLS/REALITY)
- [sing-box GitHub](https://github.com/SagerNet/sing-box)
- [sing-box SOCKS Inbound](https://sing-box.sagernet.org/configuration/inbound/socks/)
- [Hysteria2 Server Config](https://v2.hysteria.network/docs/advanced/Full-Server-Config/)
- [CVE-2023-43644](https://github.com/advisories/GHSA-r5hm-mp3j-285g)

---

*æœ¬æ–‡æ¡£æ•´åˆè‡ªå†æ¬¡ä»£ç å®¡è®¡è®°å½•ï¼Œæœ€åæ›´æ–°: 2025-12-14*
